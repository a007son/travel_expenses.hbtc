<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·®æ—…ç¶²å€ç”¢ç”Ÿå™¨</title>
    <style>
        /* --- Fluent Design Inspired Styles --- */
        :root {
            --accent-color: #0078D4;
            --accent-color-hover: #005A9E;
            --success-color: #107C10;
            --danger-color: #D83B01;
            --light-gray: #f3f3f3;
            --medium-gray: #e1e1e1;
            --dark-gray: #666;
            --text-color: #212121;
            --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft JhengHei", Roboto, "Helvetica Neue", Arial, sans-serif;
            --border-radius: 4px;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 8px rgba(0,0,0,0.1);
        }
        body {
            font-family: var(--font-family);
            margin: 0;
            padding: 2em;
            background-color: var(--light-gray);
            color: var(--text-color);
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #fff;
            padding: 2em 2.5em;
            border-radius: 8px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--medium-gray);
        }
        h1 {
            color: #000;
            text-align: center;
            margin-bottom: 0.5em;
            font-weight: 600;
        }
	h4 {
            color: #000;
            text-align: center;
            font-weight: 600;
        }
	.subtitle {
		text-align: center;
		color: #606060;
		margin-bottom: 24px;
	}
        /* --- Start/End Points --- */
        .endpoints-section {
            background: #fafafa;
            border: 1px solid var(--medium-gray);
            padding: 1.5em;
            margin-bottom: 2em;
            border-radius: var(--border-radius);
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5em;
        }
        .input-group {
            margin-bottom: 1em;
        }
        label {
            display: block;
            margin-bottom: .5em;
            font-weight: 600;
            color: var(--dark-gray);
            font-size: 0.9em;
        }
        input[type="text"], input[type="file"], select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--medium-gray);
            border-radius: var(--border-radius);
            box-sizing: border-box;
            font-size: 1em;
            transition: box-shadow 0.2s, border-color 0.2s;
        }
        input:focus, select:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(0, 120, 212, 0.3);
        }
        /* --- Tabs --- */
        .tab-container {
            display: flex;
            border-bottom: 1px solid var(--medium-gray);
            margin-bottom: 1.5em;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: transparent;
            border: none;
            border-bottom: 2px solid transparent;
            margin-bottom: -1px;
            font-size: 1em;
            font-weight: 500;
            color: var(--dark-gray);
            transition: color 0.2s, border-color 0.2s;
        }
        .tab:hover {
            color: #000;
        }
        .tab.active {
            color: var(--accent-color);
            border-bottom-color: var(--accent-color);
            font-weight: 600;
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* --- Buttons --- */
        .btn {
            padding: 10px 18px;
            border: 1px solid transparent;
            border-radius: var(--border-radius);
            font-size: 1em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .btn-primary {
            background-color: var(--accent-color);
            color: white;
        }
        .btn-primary:hover {
            background-color: var(--accent-color-hover);
            box-shadow: var(--shadow-sm);
        }
        .btn-secondary {
            background-color: #fff;
            color: var(--text-color);
            border-color: #ccc;
        }
        .btn-secondary:hover {
            background-color: #f9f9f9;
            border-color: #bbb;
        }
        .btn-danger {
            background: var(--danger-color);
            color: white;
            font-weight: bold;
            padding: 5px 10px;
        }
        .btn-danger:hover {
            opacity: 0.85;
        }
        .add-btn {
            margin-top: 10px;
            background-color: var(--success-color);
            color: white;
        }
        .add-btn:hover {
            background-color: #0E5B0E;
        }
        .main-btn {
            width: 100%;
            padding: 14px;
            font-size: 1.2em;
            font-weight: 600;
            margin-top: 2em;
        }
        .address-list .input-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: .75em;
        }
        .address-list input[type="text"] {
            flex-grow: 1;
        }

        /* --- Result Area --- */
        #result-container {
            margin-top: 2em;
            padding: 1.5em;
            background-color: #f8f8f8;
            border-radius: var(--border-radius);
            border: 1px solid var(--medium-gray);
            display: none; /* Initially hidden */
        }
        .result-input-wrapper {
            display: flex;
            gap: 10px;
            margin-bottom: 1em;
        }
        #result-url {
            flex-grow: 1;
        }
        .result-buttons {
            display: flex;
            gap: 10px;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>

    <div class="container">
        <h1>å·®æ—…ç¶²å€ç”¢ç”Ÿå™¨</h1>
		<h4>code with Gemini</h4>
	<p class="subtitle">å¯ç”¢ç”Ÿè¶…é10å€‹åœ°é»ä¹‹Google mapç¶²å€</p>
	<p class="subtitle">ğŸ‘æ¨è–¦ä½¿ç”¨ExcelåŒ¯å…¥åŠŸèƒ½(æ‰€æœ‰æ“ä½œå‡åœ¨æœ¬æ©Ÿç€è¦½å™¨å®Œæˆï¼Œæ‚¨çš„æª”æ¡ˆä¸æœƒè¢«ä¸Šå‚³ã€‚)</p>
        <div class="endpoints-section">
            <div class="input-group">
                <label for="start-point">èµ·é»</label>
                <input type="text" id="start-point" placeholder="ä¾‹å¦‚ï¼šè‡ºä¸­ç«è»Šç«™">
            </div>
            <div class="input-group">
                <label for="end-point">çµ‚é»</label>
                <input type="text" id="end-point" placeholder="ä¾‹å¦‚ï¼šå°ä¸­å¸‚æ”¿åºœè¡›ç”Ÿå±€">
            </div>
        </div>

        <div class="tab-container">
            <button class="tab active" onclick="showTab('manual')">æ‰‹å‹•è¼¸å…¥</button>
            <button class="tab" onclick="showTab('excel')">å¾ Excel åŒ¯å…¥</button>
        </div>

        <div id="manual" class="tab-content active">
            <div id="address-list">
                <div class="input-group">
                    <input type="text" placeholder="ä¸­é€”é» 1" class="address-input">
                </div>
                <div class="input-group">
                    <input type="text" placeholder="ä¸­é€”é» 2" class="address-input">
                </div>
            </div>
            <button class="btn add-btn" onclick="addAddressRow()">ï¼‹ æ–°å¢ä¸­é€”é»</button>
        </div>

        <div id="excel" class="tab-content">
            <div class="input-group">
                <label for="excel-file">é¸æ“‡ Excel (.xlsx, .xls, .csv) æª”æ¡ˆï¼š</label>
                <input type="file" id="excel-file" accept=".xlsx, .xls, .csv">
            </div>
            <div class="input-group">
                <label for="column-selector">è«‹é¸æ“‡åŒ…å«åœ°å€çš„æ¬„ä½ï¼š</label>
                <select id="column-selector" disabled>
                    <option>è«‹å…ˆä¸Šå‚³æª”æ¡ˆ</option>
                </select>
            </div>
        </div>

        <button class="btn btn-primary main-btn" onclick="generateUrl()">ç”¢ç”Ÿè·¯å¾‘ç¶²å€</button>

        <div id="result-container">
            <label for="result-url">ç”¢ç”Ÿçš„ç¶²å€ (å¯ç›´æ¥é–‹å•Ÿ)ï¼š</label>
            <div class="result-input-wrapper">
                 <input type="text" id="result-url" readonly title="æ­¤ç‚ºæ–¹ä¾¿é–±è®€çš„ç¶²å€ï¼Œè¤‡è£½è«‹ä½¿ç”¨å³æ–¹æŒ‰éˆ•">
            </div>
            <div class="result-buttons">
                <a href="#" id="open-link-btn" target="_blank" class="btn btn-primary">åœ¨æ–°åˆ†é é–‹å•Ÿ</a>
                <button id="copy-btn" class="btn btn-secondary" onclick="copyUrl()">è¤‡è£½ç¶²å€</button>
            </div>
        </div>
    </div>

    <script>
        const MAX_LOCATIONS = 24;
        let selectedColumnData = [];
        let encodedUrlForCopy = '';

        // Tabåˆ‡æ›é‚è¼¯
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            document.querySelector(`.tab[onclick="showTab('${tabName}')"]`).classList.add('active');
        }

        // æ‰‹å‹•è¼¸å…¥ï¼šæ–°å¢åœ°å€æ¬„ä½
        function addAddressRow() {
            const list = document.getElementById('address-list');
            // èµ·é»å’Œçµ‚é»ä¹Ÿç®—åœ¨å…§ï¼Œæ‰€ä»¥é€™è£¡è¦æ‰£æ‰2
            const currentCount = list.getElementsByClassName('address-input').length + 2; 
            if (currentCount >= MAX_LOCATIONS) {
                alert(`æœ€å¤šåªèƒ½æ–°å¢ ${MAX_LOCATIONS} å€‹åœ°é»(å«èµ·é»/çµ‚é»)ã€‚`);
                return;
            }
            const newRow = document.createElement('div');
            newRow.className = 'input-group';
            newRow.innerHTML = `
                <input type="text" placeholder="ä¸­é€”é» ${list.children.length + 1}" class="address-input">
                <button class="btn btn-danger" onclick="this.parentElement.remove()" title="ç§»é™¤æ­¤åœ°é»">âœ•</button>
            `;
            list.appendChild(newRow);
        }

        // Excel æª”æ¡ˆè™•ç†
        document.getElementById('excel-file').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    const json = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

                    if (json.length === 0) {
                        alert('Excelæª”æ¡ˆç‚ºç©ºæˆ–æ ¼å¼ä¸ç¬¦ï¼');
                        return;
                    }
                    
                    const columnSelector = document.getElementById('column-selector');
                    columnSelector.innerHTML = '';
                    columnSelector.disabled = false;
                    const headers = json[0] || [];
                    headers.forEach((header, index) => {
                        const option = document.createElement('option');
                        option.value = index;
                        option.textContent = `ç¬¬ ${String.fromCharCode(65 + index)} æ¬„: ${header || '(ç©º)'}`;
                        columnSelector.appendChild(option);
                    });

                    columnSelector.onchange = function() {
                        const colIndex = this.value;
                        selectedColumnData = json.slice(1)
                                                .map(row => row[colIndex])
                                                .filter(cell => cell != null && cell.toString().trim() !== '');
                    };
                    columnSelector.dispatchEvent(new Event('change'));
                } catch (error) {
                    alert('è®€å–æª”æ¡ˆæ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¢ºèªæª”æ¡ˆæ ¼å¼æ˜¯å¦æ­£ç¢ºã€‚');
                    console.error(error);
                }
            };
            reader.readAsArrayBuffer(file);
        });

        // ä¸»è¦åŠŸèƒ½ï¼šç”¢ç”Ÿç¶²å€
        function generateUrl() {
            const startPoint = document.getElementById('start-point').value.trim();
            const endPoint = document.getElementById('end-point').value.trim();

            // æª¢æŸ¥èµ·é»æˆ–çµ‚é»æ˜¯å¦ç‚ºç©ºï¼Œä¸¦è·³å‡ºç¢ºèªå°è©±æ¡†
            if (!startPoint || !endPoint) {
                // å¦‚æœä½¿ç”¨è€…é»æ“Šã€Œå–æ¶ˆã€ï¼Œå°±ä¸­æ–·å‡½å¼
                if (!confirm('æœªè¼¸å…¥èµ·è¨–åœ°é»ï¼Œä»è¦ç¹¼çºŒå—ï¼Ÿ')) {
                    return; 
                }
            }
		
            const activeTab = document.querySelector('.tab-content.active').id;
            
            let intermediatePoints = [];
            if (activeTab === 'manual') {
                document.querySelectorAll('#address-list .address-input').forEach(input => {
                    const value = input.value.trim();
                    if (value) intermediatePoints.push(value);
                });
            } else { // excel
                intermediatePoints = selectedColumnData;
            }

            let allAddresses = [startPoint, ...intermediatePoints, endPoint].filter(addr => addr);

            if (allAddresses.length < 2) {
                alert('è«‹è‡³å°‘æä¾›å…©å€‹åœ°é»ï¼ˆå¯ä»¥æ˜¯èµ·é»å’Œçµ‚é»ï¼‰ï¼');
                return;
            }
            if (allAddresses.length > MAX_LOCATIONS) {
                 alert(`ç¸½åœ°é»æ•¸é‡ (${allAddresses.length}) è¶…é ${MAX_LOCATIONS} å€‹ï¼Œå°‡åªæœƒä½¿ç”¨å‰ ${MAX_LOCATIONS} å€‹ã€‚`);
                 allAddresses = allAddresses.slice(0, MAX_LOCATIONS);
            }

            const baseUrl = 'https://www.google.com.tw/maps/dir/';
            
            // ç”¢ç”Ÿçµ¦ç€è¦½å™¨ç”¨çš„ç·¨ç¢¼å¾Œ URL
            encodedUrlForCopy = baseUrl + allAddresses.map(addr => encodeURIComponent(addr)).join('/');
            
            // ç”¢ç”Ÿçµ¦ä½¿ç”¨è€…çœ‹çš„æœªç·¨ç¢¼ URL
            const decodedUrl = baseUrl + allAddresses.join('/');

            const resultContainer = document.getElementById('result-container');
            const resultUrlInput = document.getElementById('result-url');
            const openLinkBtn = document.getElementById('open-link-btn');

            resultUrlInput.value = decodedUrl;
            openLinkBtn.href = encodedUrlForCopy;
            resultContainer.style.display = 'block';
            
            // é‡ç½®è¤‡è£½æŒ‰éˆ•ç‹€æ…‹
            const copyBtn = document.getElementById('copy-btn');
            copyBtn.textContent = 'è¤‡è£½ç¶²å€';
            copyBtn.disabled = false;
        }

        // è¤‡è£½åŠŸèƒ½
        async function copyUrl() {
            if (!encodedUrlForCopy) return;
            try {
                await navigator.clipboard.writeText(encodedUrlForCopy);
                const copyBtn = document.getElementById('copy-btn');
                copyBtn.textContent = 'å·²è¤‡è£½ï¼';
                copyBtn.disabled = true;
                setTimeout(() => {
                    copyBtn.textContent = 'è¤‡è£½ç¶²å€';
                    copyBtn.disabled = false;
                }, 2000);
            } catch (err) {
                alert('è¤‡è£½å¤±æ•—ï¼Œæ‚¨çš„ç€è¦½å™¨å¯èƒ½ä¸æ”¯æ´æ­¤åŠŸèƒ½ã€‚');
                console.error('Copy failed: ', err);
            }
        }
    </script>
</body>
</html>
